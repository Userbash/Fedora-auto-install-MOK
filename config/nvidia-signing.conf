################################################################################
# NVIDIA Signing System Configuration
# Location: /etc/nvidia-signing/nvidia-signing.conf
#
# This file contains all configuration options for the MOK system.
# Settings can be overridden by environment variables or command-line arguments.
################################################################################

# =============================================================================
# KEY MANAGEMENT
# =============================================================================

# Private key file path (must be readable only by root)
KEY_PRIVATE="/etc/pki/akmods/certs/private_key.priv"

# Public key file path
KEY_PUBLIC="/etc/pki/akmods/certs/public_key.der"

# Signing algorithm (sha256, sha512)
SIGNING_ALGORITHM="sha256"

# Allow key auto-generation if missing
ALLOW_KEY_GENERATION="no"

# =============================================================================
# DIRECTORIES
# =============================================================================

# NVIDIA modules directory
MODULES_EXTRA_PATH="/usr/lib/modules/$(uname -r)/extra"

# Kernel headers/source directory
KERNEL_SOURCE="/usr/src/kernels/$(uname -r)"

# State directory (persistent across reboots)
STATE_DIR="/var/lib/nvidia-signing"

# Backup directory for pre-signed modules
BACKUP_DIR="/var/lib/nvidia-signing/backups"

# Log directory
LOG_DIR="/var/log/nvidia-signing"

# Runtime directory
RUN_DIR="/run/nvidia-signing"

# Library directory for helper scripts
LIB_DIR="/usr/local/lib/nvidia-signing"

# =============================================================================
# SIGNING BEHAVIOR
# =============================================================================

# Enable automatic signing on boot
ENABLE_AUTO_SIGNING="yes"

# Enable automatic signing after kernel updates
ENABLE_KERNEL_UPDATE_HOOK="yes"

# Enable automatic signing after driver updates
ENABLE_DRIVER_UPDATE_HOOK="yes"

# Enable rollback support (requires backups)
ENABLE_ROLLBACK="yes"

# Backup retention days (0 = keep forever)
BACKUP_RETENTION_DAYS="30"

# =============================================================================
# VERIFICATION AND SAFETY
# =============================================================================

# Verify signatures after signing
VERIFY_AFTER_SIGNING="yes"

# Regenerate initramfs after signing
REGENERATE_INITRAMFS="yes"

# Minimum interval between signing attempts (seconds, prevents rapid re-signing)
MIN_SIGNING_INTERVAL="300"

# Maximum signing attempts before failure (cooldown)
MAX_SIGNING_ATTEMPTS="3"

# =============================================================================
# SECURITY AND HARDENING
# =============================================================================

# Enforce Secure Boot requirement
REQUIRE_SECURE_BOOT="no"

# Require MOK key enrollment
REQUIRE_MOK_ENROLLMENT="no"

# Enable SELinux policy loading
ENABLE_SELINUX_POLICY="yes"

# Enable systemd sandboxing
ENABLE_SYSTEMD_SANDBOXING="yes"

# Enable capability limiting
ENABLE_CAPABILITY_LIMITING="yes"

# Enable rate limiting protection
ENABLE_RATE_LIMITING="yes"

# Enable audit logging
ENABLE_AUDIT_LOGGING="yes"

# =============================================================================
# TPM INTEGRATION (Optional)
# =============================================================================

# Enable TPM2 integration
ENABLE_TPM2="yes"

# Use TPM for key sealing/encryption (advanced)
USE_TPM_SEALING="no"

# =============================================================================
# SYSTEMD INTEGRATION
# =============================================================================

# Enable systemd timer for periodic verification
ENABLE_TIMER="yes"

# Timer interval (6h, 24h, etc.)
TIMER_INTERVAL="6h"

# Enable systemd path unit for module directory monitoring
ENABLE_PATH_WATCHER="yes"

# Enable socket activation for on-demand triggering
ENABLE_SOCKET_ACTIVATION="yes"

# =============================================================================
# LOGGING AND DEBUGGING
# =============================================================================

# Log level (debug, info, warning, error)
LOG_LEVEL="info"

# Log to syslog
LOG_TO_SYSLOG="yes"

# Log to systemd journal
LOG_TO_JOURNAL="yes"

# Keep old logs (days)
LOG_RETENTION_DAYS="30"

# Enable debug mode (very verbose)
DEBUG_MODE="no"

# =============================================================================
# NOTIFICATIONS AND ALERTING
# =============================================================================

# Send email on signing failure (requires mail configured)
EMAIL_ON_FAILURE="no"

# Email address for notifications
ADMIN_EMAIL="root@localhost"

# Log to system alert services
ENABLE_ALERTS="yes"

# =============================================================================
# MODULE EXCLUSION
# =============================================================================

# Modules to exclude from signing (space-separated)
EXCLUDE_MODULES=""

# Example:
# EXCLUDE_MODULES="nvidia-drm nvidia-modeset"

# =============================================================================
# ADVANCED OPTIONS
# =============================================================================

# Signing timeout (seconds)
SIGNING_TIMEOUT="300"

# Initramfs regeneration timeout (seconds)
INITRAMFS_TIMEOUT="600"

# Lock file timeout (seconds)
LOCK_TIMEOUT="30"

# Preserve old initiramfs copies
PRESERVE_OLD_INITRAMFS="yes"

# =============================================================================
# EXPERIMENTAL FEATURES
# =============================================================================

# Enable kernel version change detection
DETECT_KERNEL_CHANGES="yes"

# Enable driver version change detection
DETECT_DRIVER_CHANGES="yes"

# Enable module ABI compatibility checking
CHECK_MODULE_ABI="yes"

# =============================================================================
# DROP-IN CONFIGURATION
# =============================================================================

# Include additional configuration files from directory
# Uncomment to enable:
# ConfDir=/etc/nvidia-signing/conf.d
